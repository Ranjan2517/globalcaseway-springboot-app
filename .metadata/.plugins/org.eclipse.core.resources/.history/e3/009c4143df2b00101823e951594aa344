package com.app.util;

import com.app.entity.User;
import com.app.repository.UserRepository;
import com.itextpdf.forms.PdfAcroForm;
import com.itextpdf.forms.fields.PdfFormField;
import com.itextpdf.kernel.pdf.*;

import java.io.File;
import java.io.IOException;
import java.util.Iterator;
import java.util.Map;
import org.springframework.beans.factory.annotation.Autowired;

public class FillAcroForm {

    private static final String PDF_DIRECTORY = "D:\\java xfa\\";
    private static final String INPUT_PDF = PDF_DIRECTORY + "ranjan.pdf";
    private static final String OUTPUT_PDF = PDF_DIRECTORY + "cit_filled.pdf";

    // Dummy data generator based on field names
    private static String generateDummyData(String fieldName) {
        fieldName = fieldName.toLowerCase();
        if (fieldName.contains("replacement[0].certificateno[0]")) return "CERT-123456";
        if (fieldName.contains("certificatedate")) return "01/01/2023";
        if (fieldName.contains("surname")) return "Doe";
        if (fieldName.contains("givenname")) return "John";
        if (fieldName.contains("dob[0]")) return "11/01/2020";
        if (fieldName.contains("pob")) return "PUNE";
        if (fieldName.contains("country")) return "Canada";
        if (fieldName.contains("feet")) return "5";
        if (fieldName.contains("clientuci")) return "123456";
        if (fieldName.contains("inches")) return "2inch";
        if (fieldName.contains("birthcountry")) return "India";
        if (fieldName.contains("birthdate")) return "11/02/2002";
        if (fieldName.contains("certificatenumber")) return "certifacte123";
        if (fieldName.contains("marriagedate")) return "Male";
        if (fieldName.contains("placeofmarriage")) return "Mumbai";
        if (fieldName.contains("gender")) return "Male";
        if (fieldName.contains("height")) return "180";
        if (fieldName.contains("parents")) return "Sample Parent";
        if (fieldName.contains("websitelink")) return "https://example.com";
        if (fieldName.contains("linkcit")) return "https://linkcit.sample.com";
        if (fieldName.contains("linkguide")) return "https://guide.example.com";
        return "";
    }

    public static void fillPdfWithDummyData() {
        File input = new File(INPUT_PDF);
        if (!input.exists()) {
            System.out.println("‚ùå File not found: " + INPUT_PDF);
            return;
        }

        try (PdfReader reader = new PdfReader(INPUT_PDF);
             PdfWriter writer = new PdfWriter(OUTPUT_PDF);
             PdfDocument pdfDoc = new PdfDocument(reader, writer)) {

            PdfAcroForm form = PdfAcroForm.getAcroForm(pdfDoc, true);
            if (form == null || form.getFormFields().isEmpty()) {
                System.out.println("‚ùå No AcroForm fields found.");
                return;
            }

            Map<String, PdfFormField> fields = form.getFormFields();

            System.out.println("‚úÖ Total Fields Found: " + fields.size());
            System.out.println("------------------------------------------");

            for (Map.Entry<String, PdfFormField> entry : fields.entrySet()) {
                String fieldName = entry.getKey();
                PdfFormField field = entry.getValue();

                System.out.println("üìå Field: " + fieldName);

                String dummyValue = generateDummyData(fieldName);
                field.setValue(dummyValue);

                System.out.println("üìù Filled '" + fieldName + "' with '" + dummyValue + "'");
            }

            // Optional: Flatten the form if you don't want it to be editable
            // form.flattenFields();

            System.out.println("‚úÖ Form filled successfully. Output saved to: " + OUTPUT_PDF);

        } catch (IOException e) {
            System.err.println("‚ùå Error: " + e.getMessage());
        }
    }
    
    public static void fillPdfWithDummyData(String inputPath, String outputPath) {
        try (PdfReader reader = new PdfReader(inputPath);
             PdfWriter writer = new PdfWriter(outputPath);
             PdfDocument pdfDoc = new PdfDocument(reader, writer)) {
        	
            
             
            PdfAcroForm form = PdfAcroForm.getAcroForm(pdfDoc, true);
            if (form == null || form.getFormFields().isEmpty()) {
                System.out.println("‚ùå No AcroForm fields found.");
                return;
            }

            Map<String, PdfFormField> fields = form.getFormFields();
            for (String fieldName : fields.keySet()) {
                System.out.println(fieldName);  // Print the field name
            }

            for (Map.Entry<String, PdfFormField> entry : fields.entrySet()) {
                String fullFieldName = entry.getKey();
                PdfFormField field = entry.getValue();
                String dummyValue = generateDummyData(fullFieldName);
                field.setValue(dummyValue);
            }

            // Optionally flatten fields
            // form.flattenFields();

            System.out.println("‚úÖ PDF saved to: " + outputPath);

        } catch (IOException e) {
            System.err.println("‚ùå Error filling PDF: " + e.getMessage());
        }
    }


    public static void main(String[] args) {
        fillPdfWithDummyData();
    }
}
