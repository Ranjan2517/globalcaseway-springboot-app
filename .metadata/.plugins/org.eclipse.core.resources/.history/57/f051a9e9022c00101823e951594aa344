package com.app.util;

import com.app.entity.User;
import com.app.pojo.ClientData;
import com.app.repository.UserRepository;
import com.fasterxml.jackson.databind.ObjectMapper;
import com.itextpdf.forms.PdfAcroForm;
import com.itextpdf.forms.fields.PdfFormField;
import com.itextpdf.kernel.pdf.*;

import java.io.File;
import java.io.IOException;
import java.util.Iterator;
import java.util.Map;
import org.springframework.beans.factory.annotation.Autowired;

public class FillAcroForm {


    // Dummy data generator based on field names
	private static String generateDummyData(String fieldName, String clientData1Json) {
	    try {
	        ObjectMapper objectMapper = new ObjectMapper();
	        ClientData clientData = objectMapper.readValue(clientData1Json, ClientData.class);
	   
	        fieldName = fieldName.toLowerCase();
	        if (fieldName.contains("certificatedate")) return "01/01/2023";
	        if (fieldName.contains("replacement[0].surname[0]")) return clientData.getBasicInformation().getFormsdata().getLastName();
	        if (fieldName.contains("replacement[0].givenname[0]"))
	            return clientData.getBasicInformation().getFormsdata().getFirstName() != null
	                ? clientData.getBasicInformation().getFormsdata().getFirstName()
	                : "";
	        if (fieldName.contains("bcsurname[0]")) return clientData.getBasicInformation().getFormsdata().getLastName();
	        if (fieldName.contains("bcgivenname[0]")) return clientData.getBasicInformation().getFormsdata().getFirstName();
	        if (fieldName.contains("dob[0]")) return clientData.getBasicInformation().getFormsdata().getDob();
	        if (fieldName.contains("pob")) return "";
	        if (fieldName.contains("country")) return clientData.getBasicInformation().getFormsdata().getCitizenship().get(0);
	        if (fieldName.contains("feet")) return "";
	        if (fieldName.contains("clientuci")) return "";
	        if (fieldName.contains("inches")) return "";
	        if (fieldName.contains("birthcountry")) return "";
	      
	        
	        
	        
	        //parent 1
	        if (fieldName.contains("parent1[0].information[0].surname[0]")) return clientData.getParentDetails().getFormsdata().getFatherInfo().getFirstName();
	        if (fieldName.contains("parent1[0].information[0].givenname[0]")) return clientData.getParentDetails().getFormsdata().getFatherInfo().getLastName();
	        if (fieldName.contains("parent1[0].information[0].othernames[0]")) return "";
	        if (fieldName.contains("parent1[0].information[0].birthcountry[0]")) return clientData.getParentDetails().getFormsdata().getFatherInfo().getBirthCountry();
	        if (fieldName.contains("parent1[0].information[0].certificatenumber[0]")) return "";
	        if (fieldName.contains("parent1[0].information[0].marriagedate[0]")) return "";
	        if (fieldName.contains("parent1[0].information[0].placeofmarriage[0]")) return "";
	        
	        //parent 1
	        if (fieldName.contains("parent2[0].information[0].surname[0]")) return clientData.getParentDetails().getFormsdata().getMotherInfo().getFirstName();
	        if (fieldName.contains("parent2[0].information[0].givenname[0]")) return clientData.getParentDetails().getFormsdata().getMotherInfo().getLastName();
	        if (fieldName.contains("parent2[0].information[0].othernames[0]")) return "";
	        if (fieldName.contains("parent2[0].information[0].birthcountry[0]")) return clientData.getParentDetails().getFormsdata().getMotherInfo().getBirthCountry();
	        if (fieldName.contains("parent1[0].information[0].certificatenumber[0]")) return "";
	        if (fieldName.contains("parent1[0].information[0].marriagedate[0]")) return "";
	        if (fieldName.contains("parent1[0].information[0].placeofmarriage[0]")) return "";
	        
	        
	        
	   

	    } catch (Exception e) {
	        e.printStackTrace(); // You can log this instead
	    }

	    return "";
	}


 
    
    public static void fillPdfWithDummyData(String inputPath, String outputPath, String clientData1Json) {
        try (PdfReader reader = new PdfReader(inputPath);
             PdfWriter writer = new PdfWriter(outputPath);
             PdfDocument pdfDoc = new PdfDocument(reader, writer)) {
        	
        	ObjectMapper objectMapper = new ObjectMapper();
            ClientData clientData = objectMapper.readValue(clientData1Json, ClientData.class);
	        System.out.println("clientData: " + objectMapper.writeValueAsString(clientData.getBasicInformation().getFormsdata()));

            // ✅ Print some values from Java object
            System.out.println("Client First Name: " +
                clientData.getBasicInformation().getFormsdata().getFirstName());

            System.out.println("Intended Location: " +
                clientData.getBasicInformation().getFormsdata().getIntendedLocation());

            System.out.println("Father's Occupation: " +
                clientData.getParentDetails().getFormsdata().getFatherInfo().getOccupation());
            
             
            PdfAcroForm form = PdfAcroForm.getAcroForm(pdfDoc, true);
            if (form == null || form.getFormFields().isEmpty()) {
                System.out.println("❌ No AcroForm fields found.");
                return;
            }

            Map<String, PdfFormField> fields = form.getFormFields();
            for (String fieldName : fields.keySet()) {
                System.out.println(fieldName);  // Print the field name
            }

            for (Map.Entry<String, PdfFormField> entry : fields.entrySet()) {
                String fullFieldName = entry.getKey();
                PdfFormField field = entry.getValue();
                String dummyValue = generateDummyData(fullFieldName,clientData1Json);
                field.setValue(dummyValue);
            }

            // Optionally flatten fields
            // form.flattenFields();

            System.out.println("✅ PDF saved to: " + outputPath);

        } catch (IOException e) {
            System.err.println("❌ Error filling PDF: " + e.getMessage());
        }
    }

}
